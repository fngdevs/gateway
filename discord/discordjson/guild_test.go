package discordjson

import (
	"fmt"
	"testing"

	"cdr.dev/slog/sloggers/slogtest/assert"
	"github.com/davecgh/go-spew/spew"
	jsoniter "github.com/json-iterator/go"
)

var guildJSON = []byte(`{"id": "173184118492889089", "name": "Tatsu's Lounge", "icon": "e675a9678e15230ffeef9b0cdc70f2fd", "description": null, "splash": "6dedd786e8b3c8a01329535ce6565fa5", "discovery_splash": null, "features": ["PARTNERED", "NEWS", "VANITY_URL", "PUBLIC", "BANNER", "COMMERCE", "ANIMATED_ICON", "VIP_REGIONS", "INVITE_SPLASH"], "emojis": [{"name": "Noire", "roles": [], "id": "230176605752918016", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "tatsustare", "roles": [], "id": "230255660774850560", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "MikuDoom", "roles": [], "id": "235988268959793152", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "UmiPokerface", "roles": [], "id": "235988322978234368", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "UWot", "roles": [], "id": "235988376698748928", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "Vanilla", "roles": [], "id": "235988413910745089", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "jigenlol", "roles": [], "id": "242162217317826561", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "rusure", "roles": [], "id": "242162281486614529", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "bux", "roles": [], "id": "284897850490355712", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "bearno", "roles": [], "id": "287250196792868864", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "bearzooka", "roles": [], "id": "287256699633401856", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "bearyes", "roles": [], "id": "287265103110340610", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "slider", "roles": [], "id": "287497076957511681", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "bearhuh", "roles": [], "id": "287823279127920640", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "bearthonk", "roles": [], "id": "288302138973618176", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "bearthonk2", "roles": [], "id": "288302139049115649", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "bearnoevil", "roles": [], "id": "288320859247083520", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "boxcat", "roles": [], "id": "288491102187814912", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "baevid", "roles": [], "id": "288674131208306698", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "bearnot", "roles": [], "id": "289073929539158017", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "matcat", "roles": [], "id": "289799378036850699", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "bearwave", "roles": [], "id": "290471664494575616", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "bearwave2", "roles": [], "id": "290859628542033930", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "nice", "roles": [], "id": "290966036621164545", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "catwave", "roles": [], "id": "291419910448349184", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "seen", "roles": [], "id": "291735747826810880", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "bearfaint", "roles": [], "id": "294483007442518016", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "sadpotato", "roles": [], "id": "294488446230069249", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "evilpotato2", "roles": [], "id": "294847075881975809", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "neat", "roles": [], "id": "295932658603655168", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "bearban", "roles": [], "id": "296268893293510656", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "potatoyes", "roles": [], "id": "296288179689095178", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "dogangst", "roles": [], "id": "297017040634380290", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "angrydance", "roles": [], "id": "297617489691410434", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "cathug", "roles": [], "id": "299974426458587136", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "itsJake", "roles": [], "id": "304208705229160450", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "tatsumaki", "roles": [], "id": "311569047542038529", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "catpeek", "roles": [], "id": "330978658737192960", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "smugMLG", "roles": [], "id": "357458641093263362", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "davidcat", "roles": [], "id": "364595234744565766", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "esjacathug", "roles": [], "id": "375608989766909953", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "yaradoggo", "roles": [], "id": "381969698989932544", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "yaradoggo2", "roles": [], "id": "381969723039940618", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "wtfthonk", "roles": [], "id": "393561362690998272", "require_colons": true, "managed": false, "animated": true, "available": true}, {"name": "swag", "roles": [], "id": "393561533315284992", "require_colons": true, "managed": false, "animated": true, "available": true}, {"name": "ame", "roles": [], "id": "393913705131409409", "require_colons": true, "managed": false, "animated": true, "available": true}, {"name": "rooW", "roles": [], "id": "395748499020316672", "require_colons": true, "managed": false, "animated": true, "available": true}, {"name": "BLELELE", "roles": [], "id": "411346402753642496", "require_colons": true, "managed": false, "animated": true, "available": true}, {"name": "matdog", "roles": [], "id": "412690911693373441", "require_colons": true, "managed": false, "animated": true, "available": true}, {"name": "kirban", "roles": [], "id": "431526757317738524", "require_colons": true, "managed": false, "animated": true, "available": true}, {"name": "kyuclap", "roles": [], "id": "436964420883709953", "require_colons": true, "managed": false, "animated": true, "available": true}, {"name": "kyueats", "roles": [], "id": "436964787260227585", "require_colons": true, "managed": false, "animated": true, "available": true}, {"name": "diskirb", "roles": [], "id": "463755793334796298", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "what", "roles": [], "id": "466510506820370432", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "nonsfw", "roles": [], "id": "477677211734900747", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "pogslide", "roles": [], "id": "485482999908007936", "require_colons": true, "managed": false, "animated": true, "available": true}, {"name": "kirbslep", "roles": [], "id": "497446283586437155", "require_colons": true, "managed": false, "animated": true, "available": true}, {"name": "kirbwake", "roles": [], "id": "497446902011396097", "require_colons": true, "managed": false, "animated": true, "available": true}, {"name": "fedex", "roles": [], "id": "534478781348446218", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "frownex", "roles": [], "id": "534484068830674964", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "baba", "roles": [], "id": "555832940635095041", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "herecomesmoney", "roles": [], "id": "598565124508483585", "require_colons": true, "managed": false, "animated": true, "available": true}, {"name": "esjaLurk", "roles": [], "id": "610828203275190272", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "mine", "roles": [], "id": "618516874438639636", "require_colons": true, "managed": false, "animated": true, "available": true}, {"name": "CHONKY", "roles": [], "id": "641135155892846603", "require_colons": true, "managed": false, "animated": true, "available": true}, {"name": "xDavid", "roles": [], "id": "647851476466794499", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "ack", "roles": [], "id": "670615080819228672", "require_colons": true, "managed": false, "animated": true, "available": true}, {"name": "partyack", "roles": [], "id": "670615280862625842", "require_colons": true, "managed": false, "animated": true, "available": true}, {"name": "tatsu2", "roles": [], "id": "672373805309493252", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "tatsu1", "roles": [], "id": "672373805334659082", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "tatsu9", "roles": [], "id": "672373805351698433", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "tatsu4", "roles": [], "id": "672373805360087040", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "tatsu7", "roles": [], "id": "672373805372669963", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "tatsu6", "roles": [], "id": "672373805489979413", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "tatsu3", "roles": [], "id": "672373805565345792", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "tatsu5", "roles": [], "id": "672373805586317312", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "tatsu8", "roles": [], "id": "672373805645168640", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "tatsublank", "roles": [], "id": "672374649488932865", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "japaneseBobtailSleep", "roles": [], "id": "672426387046531112", "require_colons": true, "managed": false, "animated": false, "available": true}, {"name": "workbench", "roles": [], "id": "672442299677933572", "require_colons": true, "managed": false, "animated": false, "available": true}], "banner": "0c354f07f3634f597c1a50f79ec603d2", "owner_id": "131904411789164544", "application_id": null, "region": "us-east", "afk_channel_id": null, "afk_timeout": 300, "system_channel_id": "581517596541845524", "widget_enabled": true, "widget_channel_id": "272212345340690443", "verification_level": 3, "roles": [{"id": "173184118492889089", "name": "@everyone", "permissions": 37080064, "position": 0, "color": 0, "hoist": false, "managed": false, "mentionable": false}, {"id": "175654938540638208", "name": "Developers", "permissions": 2146828023, "position": 52, "color": 15277667, "hoist": true, "managed": false, "mentionable": false}, {"id": "179620513373487105", "name": "Beta Usergroup", "permissions": 67109440, "position": 33, "color": 13929671, "hoist": false, "managed": false, "mentionable": false}, {"id": "183995426154741762", "name": "Boats", "permissions": 83894848, "position": 28, "color": 0, "hoist": true, "managed": false, "mentionable": false}, {"id": "191764872059551744", "name": "Other Devs", "permissions": 67109440, "position": 34, "color": 9025791, "hoist": false, "managed": false, "mentionable": false}, {"id": "191768669099917313", "name": "Mirai", "permissions": 67109440, "position": 48, "color": 15702682, "hoist": false, "managed": false, "mentionable": false}, {"id": "195525343237373952", "name": "Support", "permissions": 238153431, "position": 50, "color": 12275682, "hoist": true, "managed": false, "mentionable": false}, {"id": "206044045171097600", "name": "Translators", "permissions": 67109440, "position": 31, "color": 3447003, "hoist": false, "managed": false, "mentionable": false}, {"id": "221896312235360256", "name": "Tatsu", "permissions": 2146823935, "position": 55, "color": 3066993, "hoist": true, "managed": false, "mentionable": false}, {"id": "224538661407031297", "name": "Contributors", "permissions": 104197699, "position": 49, "color": 2123412, "hoist": false, "managed": false, "mentionable": false}, {"id": "241159197633413120", "name": "Patreon Bot", "permissions": 268436032, "position": 42, "color": 0, "hoist": false, "managed": true, "mentionable": false}, {"id": "241160306271846400", "name": "Supporter", "permissions": 67111488, "position": 36, "color": 16626299, "hoist": false, "managed": false, "mentionable": false}, {"id": "294662467659759616", "name": "Tag Creators", "permissions": 512, "position": 44, "color": 1752220, "hoist": false, "managed": false, "mentionable": false}, {"id": "300824408249991168", "name": "Language Coordinators", "permissions": 576, "position": 45, "color": 7169785, "hoist": false, "managed": false, "mentionable": false}, {"id": "304457558436085761", "name": "Talkative", "permissions": 512, "position": 12, "color": 9610921, "hoist": false, "managed": false, "mentionable": false}, {"id": "304457796307648512", "name": "Chatterbox", "permissions": 512, "position": 13, "color": 8098711, "hoist": false, "managed": false, "mentionable": false}, {"id": "304457982627020801", "name": "Outspoken", "permissions": 67109440, "position": 14, "color": 6981258, "hoist": false, "managed": false, "mentionable": false}, {"id": "304458046304813057", "name": "Old Timer", "permissions": 67109440, "position": 15, "color": 5995134, "hoist": false, "managed": false, "mentionable": false}, {"id": "306225290898833418", "name": "Helpers", "permissions": 267775574, "position": 47, "color": 58998, "hoist": true, "managed": false, "mentionable": false}, {"id": "360173493687418893", "name": "Dyno", "permissions": 2146791159, "position": 30, "color": 0, "hoist": false, "managed": true, "mentionable": false}, {"id": "375857133008191489", "name": "Patron+", "permissions": 67111488, "position": 38, "color": 16555355, "hoist": false, "managed": false, "mentionable": false}, {"id": "375857326243971072", "name": "Patron++", "permissions": 67471936, "position": 39, "color": 16555355, "hoist": false, "managed": false, "mentionable": false}, {"id": "375857329804935168", "name": "Patron\u2732", "permissions": 67111488, "position": 40, "color": 15105570, "hoist": false, "managed": false, "mentionable": false}, {"id": "375857447103102976", "name": "Patron\u2732\u2732", "permissions": 67111488, "position": 41, "color": 15105570, "hoist": false, "managed": false, "mentionable": false}, {"id": "375857639701217294", "name": "Patrons", "permissions": 512, "position": 35, "color": 0, "hoist": true, "managed": false, "mentionable": false}, {"id": "375891133236248578", "name": "Patron", "permissions": 67111488, "position": 37, "color": 16755055, "hoist": false, "managed": false, "mentionable": false}, {"id": "398863552863010817", "name": "haru", "permissions": 8768, "position": 11, "color": 0, "hoist": false, "managed": true, "mentionable": false}, {"id": "399947075997007872", "name": "Super Human", "permissions": 67489345, "position": 19, "color": 5995134, "hoist": false, "managed": false, "mentionable": false}, {"id": "399947083513069570", "name": "Exquisite", "permissions": 67109440, "position": 18, "color": 5995134, "hoist": false, "managed": false, "mentionable": false}, {"id": "399947087132753921", "name": "Distinguished", "permissions": 67109440, "position": 17, "color": 5995134, "hoist": false, "managed": false, "mentionable": false}, {"id": "399947266208825348", "name": "Over-BEAR-ing", "permissions": 67109440, "position": 16, "color": 5995134, "hoist": false, "managed": false, "mentionable": false}, {"id": "399947703276011521", "name": "Almost Robot", "permissions": 67109440, "position": 20, "color": 5995134, "hoist": false, "managed": false, "mentionable": false}, {"id": "402246996179812352", "name": "Community", "permissions": 2560, "position": 10, "color": 0, "hoist": false, "managed": false, "mentionable": false}, {"id": "419477861569658881", "name": "APIGuy", "permissions": 512, "position": 9, "color": 0, "hoist": false, "managed": false, "mentionable": false}, {"id": "439423423782060041", "name": "Guide", "permissions": 67109376, "position": 46, "color": 1752220, "hoist": false, "managed": false, "mentionable": false}, {"id": "442427442012094475", "name": "Developers (Not Hoisted)", "permissions": 2146828023, "position": 51, "color": 15277667, "hoist": false, "managed": false, "mentionable": false}, {"id": "458115238357630977", "name": "FFXIV", "permissions": 512, "position": 8, "color": 0, "hoist": false, "managed": false, "mentionable": false}, {"id": "467785933761019924", "name": "Dyno Premium", "permissions": 2146791159, "position": 29, "color": 0, "hoist": false, "managed": true, "mentionable": false}, {"id": "543336259699867648", "name": "Muted", "permissions": 37080640, "position": 7, "color": 8487814, "hoist": true, "managed": false, "mentionable": false}, {"id": "567370180267737109", "name": "Spaminator", "permissions": 67109440, "position": 21, "color": 5995134, "hoist": false, "managed": false, "mentionable": false}, {"id": "567370996873560064", "name": "Big Small Talker", "permissions": 67109440, "position": 22, "color": 5995134, "hoist": false, "managed": false, "mentionable": false}, {"id": "567371313690312705", "name": "Typowriter", "permissions": 67109440, "position": 23, "color": 5995134, "hoist": false, "managed": false, "mentionable": false}, {"id": "567371608982028308", "name": "Wordsmith", "permissions": 67109440, "position": 24, "color": 5995134, "hoist": false, "managed": false, "mentionable": false}, {"id": "567372193718206484", "name": "Yakety Yak", "permissions": 67109440, "position": 26, "color": 5995134, "hoist": false, "managed": false, "mentionable": false}, {"id": "567372200127102997", "name": "Discord Novelist", "permissions": 67109440, "position": 25, "color": 5995134, "hoist": false, "managed": false, "mentionable": false}, {"id": "567372711261896704", "name": "Rawrsome", "permissions": 67109440, "position": 27, "color": 5995134, "hoist": false, "managed": false, "mentionable": false}, {"id": "574859347377782794", "name": "Blurple Canvas", "permissions": 322624, "position": 6, "color": 0, "hoist": false, "managed": true, "mentionable": false}, {"id": "575262119453392911", "name": "Blurplefied", "permissions": 19457, "position": 5, "color": 0, "hoist": false, "managed": true, "mentionable": false}, {"id": "585555896722128906", "name": "Nitro Booster", "permissions": 104188928, "position": 32, "color": 16751600, "hoist": true, "managed": true, "mentionable": false}, {"id": "595992994835071007", "name": "[DEV UPDATES]", "permissions": 37080064, "position": 4, "color": 0, "hoist": false, "managed": false, "mentionable": false}, {"id": "595993879363190784", "name": "[FEATURE UPDATES]", "permissions": 0, "position": 3, "color": 0, "hoist": false, "managed": false, "mentionable": false}, {"id": "595994150042861568", "name": "[EVENT UPDATES]", "permissions": 0, "position": 2, "color": 0, "hoist": false, "managed": false, "mentionable": false}, {"id": "610124232491270155", "name": "Tatsu Backup", "permissions": 2146823671, "position": 1, "color": 0, "hoist": false, "managed": true, "mentionable": false}, {"id": "638986307002957853", "name": "Blue Color", "permissions": 0, "position": 43, "color": 3447003, "hoist": false, "managed": false, "mentionable": false}, {"id": "661840333763510274", "name": "Community Manager", "permissions": 2146824183, "position": 54, "color": 15866106, "hoist": true, "managed": false, "mentionable": true}, {"id": "664687695603302400", "name": "thy x abal", "permissions": 37080072, "position": 53, "color": 0, "hoist": false, "managed": false, "mentionable": false}], "default_message_notifications": 1, "mfa_level": 0, "explicit_content_filter": 2, "max_presences": 25000, "max_members": 250000, "vanity_url_code": "tatsu", "premium_tier": 2, "premium_subscription_count": 29, "system_channel_flags": 1, "preferred_locale": "en-US", "rules_channel_id": "332185656845533186", "public_updates_channel_id": null, "embed_enabled": true, "embed_channel_id": "272212345340690443"}`)
var _ = spew.Dump

func TestGuildCreate(t *testing.T) {
	gc, err := (&decoder{}).DecodeGuildCreate(guildJSON)
	assert.Success(t, "failed to decode guild", err)

	_ = gc
	// spew.Dump(gc)
}

func TestJSONIter(t *testing.T) {
	iter := jsoniter.ParseBytes(jsoniter.ConfigFastest, guildJSON)
	iter.ReadObjectCB(func(iter *jsoniter.Iterator, key string) bool {
		fmt.Println(key)
		iter.Skip()
		return true
	})
}
